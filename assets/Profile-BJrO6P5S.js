import{c as S,y as _,u as U,r as u,j as e,F as i,K as r,a3 as q,a4 as D,a5 as M,a6 as k,G as E,J as F,B as L,a7 as P,s as p}from"./index-DBMRuhZV.js";import{u as v}from"./useQuery-B4ix4t-Z.js";import{M as V}from"./mail-AeRyCJzK.js";import{C as b}from"./calendar-BLjjBWUb.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=S("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function T(){var x,h,j,g;const{t}=_(["profile","common","community"]),{session:a}=U(),[o,m]=u.useState(!1),{data:s,isLoading:f}=v({queryKey:["profiles",a==null?void 0:a.user.id],queryFn:async()=>{const{data:l,error:c}=await p.from("profiles").select("*").eq("id",a==null?void 0:a.user.id).single();if(c)throw c;return l},enabled:!!(a!=null&&a.user.id)}),{data:d=[]}=v({queryKey:["user-communities",a==null?void 0:a.user.id],queryFn:async()=>{if(!(a!=null&&a.user.id))return[];const{data:l,error:c}=await p.from("community_memberships").select("role, community:communities(*, community_memberships(count))").eq("user_id",a.user.id);if(c)throw c;return(l==null?void 0:l.map(n=>{var N;return{...n.community,role:n.role,member_count:((N=n.community.community_memberships[0])==null?void 0:N.count)??0}}))??[]},enabled:!!(a!=null&&a.user.id)}),y=()=>{m(!1)},w=()=>{m(!1)};if(u.useMemo(()=>d.filter(l=>l.role==="owner"),[d]),u.useMemo(()=>d.filter(l=>l.role==="admin"),[d]),f)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/4 mb-2"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(i,{className:"animate-pulse",children:e.jsxs(r,{className:"p-6",children:[e.jsx("div",{className:"w-24 h-24 bg-muted rounded-full mx-auto mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-6 bg-muted rounded w-3/4 mx-auto"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(i,{className:"animate-pulse",children:e.jsxs(r,{className:"p-6 space-y-4",children:[e.jsx("div",{className:"h-6 bg-muted rounded w-1/4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-10 bg-muted rounded"}),e.jsx("div",{className:"h-10 bg-muted rounded"}),e.jsx("div",{className:"h-20 bg-muted rounded"})]})]})})})]})]});i,r,q,D,s!=null&&s.avatar_url,M,(x=s==null?void 0:s.display_name)!=null&&x[0]||(h=s==null?void 0:s.username)!=null&&h[0]||(g=(j=a==null?void 0:a.user.email)==null?void 0:j[0])!=null&&g.toUpperCase(),s!=null&&s.display_name||s!=null&&s.username,s!=null&&s.username,V,a==null||a.user.email,k,t("common:status"),s!=null&&s.username?t("common:active"):t("common:pending"),b,t("profile:memberSince",{defaultValue:"Member since {{date}}",date:new Date((s==null?void 0:s.created_at)||Date.now()).toLocaleDateString()});const C=e.jsxs(i,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between",children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),t("profile:accountSettings")]}),o?null:e.jsx(L,{variant:"outline",size:"sm",onClick:()=>m(!0),"data-testid":"button-edit-profile",children:t("common:edit")})]}),e.jsx(r,{children:e.jsx(P,{initialProfile:s,onSuccess:w,isEditing:o,onCancelEdit:y,isUsernameDisabled:!!(s!=null&&s.username),submitButtonText:t("common:save")})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-fg","data-testid":"profile-title",children:t("profile:title")}),e.jsx("p",{className:"text-muted my-1",children:t("profile:subtitle")}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:t("profile:memberSince",{defaultValue:"Member since {{date}}",date:new Date((s==null?void 0:s.created_at)||Date.now()).toLocaleDateString()})})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:C})]})}export{T as default};
